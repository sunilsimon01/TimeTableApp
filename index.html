<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&family=Poppins:wght@300&display=swap" rel="stylesheet">
</head>
<body >
    <div class = "wrapper">
     <br><br>
     <!-- <h1 class = "text"style="margin: auto;">TIME TABLE APP</h1> -->
     <div class="div" style="display: flex; justify-content: center;"><span contenteditable="false" class="neumorphic">CLOCKWISE</span></div>
    <br><br>
        <div class="div" id="batch1" style="display: flex" >
            <div class="div" id = "details">
                <div class="fields">
                    <div class="username"><input type="username" class="user-input" placeholder="Enter Course Name" id="course1" /></div>
            <label> Select Slot
            <div class="select-dropdown">
                <select name = "slot" id = "slot1">
                    <option value="A1">A1</option>
                    <option value="B1">B1</option>
                    <option value="C1">C1</option>
                    <option value="D1">D1</option>
                    <option value="E1">E1</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P1">P1</option>
                    <option value="Q1">Q1</option>
                    <option value="R1">R1</option>
                    <option value="S1">S1</option>
                    <option value="T1">T1</option>
                </select>
              </div>
            </label>
            <br>
            <div class="neumorphism-toggle">
                <input type="checkbox" id="Plus1" >
                <label for="Plus1">
                    <div class="switch">
                        <div class="dot"></div>
                    </div>
                    <span>Include + Slot</span>
                </label>
            </div>
            <br>
            <button class="signin-button" id ="submitbtn1">Submit</button>
            <span></span>
            <span></span> 
             </div>
        </div>
        
        <div>
        <table
        id = "table1"
        class="neumorphic"
        border="0" 
        cellspacing="0" 
        align="center" 
        >
            <tr>
                <td align="center" height="50"
                    width="80" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F1 08-08:50-MO" id="11"></td>
                <td align="center" height="50" class="A1 09-09:50-MO" id="12"></td>
                <td align="center" height="50" class="B1 10-10:50-MO" id="13"></td>
                <td align="center" height="50" class="C1 11-11:50-MO" id="14"></td>
                <td align="center" height="50" class="D1+ 12-12:50-MO" id="15"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td colspan="3" align="center"
                    height="50" class="P1 14-16:50-MO"></td>
                <td align="center" height="50" class="G1 17-17:50-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H1 08-08:50-TU"></td>
                <td align="center" height="50" class="B1 09-09:50-TU"></td>
                <td align="center" height="50" class="C1 10-10:50-TU"></td>
                <td align="center" height="50" class="D1 11-11:50-TU"></td>
                <td align="center" height="50" class="E1+ 12-12:50-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q1 14-16:50-TU"></td>
                <td align="center" height="50" class="F1 17-17:50-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G1 08:00-08:50-WE"></td>
                <td align="center" height="50" class="C1 09:00-09:50-WE"></td>
                <td align="center" height="50" class="D1 10-10:50-WE"></td>
                <td align="center" height="50" class="E1 11-11:50-WE"></td>
                <td align="center" height="50" class="A1+ 12-12:50-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R1 14-16:50-WE">
                </td>
                <td align="center" height="50" class="H1 17-17:50-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F1 08-08:50-TH"></td>
                <td align="center" height="50" class="D1 09-09:50-TH"></td>
                <td align="center" height="50" class="E1 10-10:50-TH"></td>
                <td align="center" height="50" class="A1 11-11:50-TH"></td>
                <td align="center" height="50" class="B1+ 12-12:50-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S1 14-16:50-TH">
                </td>
                <td align="center" height="50" class="G1 17-17:50-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H1 08-08:50-FR"></td>
                <td align="center" height="50" class="E1 09-09:50-FR"></td>
                <td align="center" height="50" class="A1 10-10:50-FR"></td>
                <td align="center" height="50" class="B1 11-11-FR"></td>
                <td align="center" height="50" class="C1+ 12-12:50-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T1 14-16:50pm-FR">
                </td>
                <td align="center" height="50" class="F1+ 17-17:50-FR"></td>
            </tr>
        </table>
    </div>
    </div>

    <!--     Second batch     -->
    <div id="batch2" style="display: none;">
            <div id = "details2">
                <div class="fields">
                    <div class="username"><input type="username" class="user-input" placeholder="Enter Course Name" id="course2" /></div>
            <label> Select Slot
                <div class="select-dropdown">
                    <select name = "slot" id = "slot2">
                    <option value="A2">A2</option>
                    <option value="B2">B2</option>
                    <option value="C2">C2</option>
                    <option value="D2">D2</option>
                    <option value="E2">E2</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="P2">P2</option>
                    <option value="Q2">Q2</option>
                    <option value="R2">R2</option>
                    <option value="S2">S2</option>
                    <option value="T2">T2</option>
                    </select>
                </div>
            </label>
            <br>
            <div class="neumorphism-toggle">
                <input type="checkbox" id="Plus2" >
                <label for="Plus2">
                    <div class="switch">
                        <div class="dot"></div>
                    </div>
                    <span>Include + Slot</span>
                </label>
            </div>
            <br>
            <button class="signin-button" id ="submitbtn2">Submit</button>
            <span></span>
            <span></span>
            </div>
        </div>
        <div>
        <table id="table2"
        class="neumorphic"
        border="0" 
        cellspacing="0" 
        align="center" >
            <tr>
                <td align="center" height="50"
                    width="80" class="top"><br>
                    <b>Day/Period</b></br>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>I<br>8:00-8:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>II<br>9:00-9:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>III<br>10:00-10:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>IV<br>11:00-11:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>V<br>12:00-12:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VI<br>1:00-1:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VII<br>2:00-2:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>VIII<br>3:00-3:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>IX<br>4:00-4:50</b>
                </td>
                <td align="center" height="50"
                    width="80" class="top">
                    <b>X<br>5:00-5:50</b>
                </td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Monday</b></td>
                <td align="center" height="50" class="F2 08-08:50-MO" id="11"></td>
                <td colspan="3" align="center"
                    height="50" id="P2 09-11:50-MO"></td>
                <td rowspan="6" align="center" height="50" class="lunch">
                    <h2>L<br>U<br>N<br>C<br>H</h2>
                </td>
                <td align="center" height="50" class="D2+ 13-13:50-MO" id="12"></td>
                <td align="center" height="50" class="A2 14-14:50-MO" id="13"></td>
                <td align="center" height="50" class="B2 15-15:50-MO" id="14"></td>
                <td align="center" height="50" class="C2 16-16:50-MO" id="15"></td>
                <td align="center" height="50" class="G2 17-17:50-MO"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Tuesday</b>
                </td>
                <td align="center" height="50" class="H2 08-08:50-TU"></td>
                <td colspan="3" align="center"
                    height="50" class="Q2 09-11:50-TU"></td>
                <td align="center" height="50" class="E2+ 13-13:50-TU"></td>
                <td align="center" height="50" class="B2 14-14:50-TU"></td>
                <td align="center" height="50" class="C2 15-15:50-TU"></td>
                <td align="center" height="50" class="D2 16-16:50-TU"></td>
                <td align="center" height="50" class="F2 17-17:50-TU"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Wednesday</b>
                </td>
                <td align="center" height="50" class="G2 08-08:50-WE"></td>
                <td colspan="3" align="center"
                    height="50" class="R2 09-11:50-WE">
                </td>
                <td align="center" height="50" class="A2+ 13-13:50-WE"></td>
                <td align="center" height="50" class="C2 14-14:50-WE"></td>
                <td align="center" height="50" class="D2 15-15:50-WE"></td>
                <td align="center" height="50" class="E2 16-16:50-WE"></td>
                <td align="center" height="50" class="H2 17-17:50-WE"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Thursday</b>
                </td>
                <td align="center" height="50" class="F2 08-08:50-TH"></td>
                <td colspan="3" align="center"
                    height="50" class="S2 09-11:50-TH">
                </td>
                <td align="center" height="50" class="B2+ 13-13:50-TH"></td>
                <td align="center" height="50" class="D2 14-14:50-TH"></td>
                <td align="center" height="50" class="E2 15-15:50-TH"></td>
                <td align="center" height="50" class="A2 16-16:50-TH"></td>
                <td align="center" height="50" class="G2 17-17:50-TH"></td>
            </tr>
            <tr>
                <td align="center" height="50" class="side">
                    <b>Friday</b>
                </td>
                <td align="center" height="50" class="H2 08-08:50-FR"></td>
                <td colspan="3" align="center"
                    height="50" class="T2 09-11:50-FR">
                </td>
                <td align="center" height="50" class="C2+ 13-13:50-FR"></td>
                <td align="center" height="50" class="E2 14-14:50-FR"></td>
                <td align="center" height="50" class="A2 15-15:50-FR"></td>
                <td align="center" height="50" class="B2 16-16:50-FR"></td>
                <td align="center" height="50" class="F2+ 17-17:50-FR"></td>
            </tr>
        </table>
        </div>
    </div>
    <br><br>
    <nav>      
    <ul class="nav">       
      <li><a href="#" id="batchChange"><span class = "btntxt">Switch<br> batch</span></a></li>
      <li><a href = "#" id="pdfdownload"><span class = "btntxt">Download<br> PDF</span></a></li>
      <li><a href = "#" id="iCal"><span class = "btntxt">Download ICS</span></a></li>
      
    </ul>
  </nav>
    <ul class="bg-bubbles">
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
	</ul> 
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>
 <script> 
    let batch = 1;
    let inEdit = false;

    function validateForm()
    {
        let courseName = document.getElementById("course" + batch).value;
        let slot = document.getElementById("slot" + batch).value;
        if(slot == "F" || slot == "G" || slot == "H")
            slot += batch;
        let checked = document.getElementById("Plus" + batch);
        let slots = document.getElementsByClassName(slot);
              
        let slotsPlus = document.getElementsByClassName(slot + "+");
        for(var i = 0; i < slots.length; i++)
            slots[i].innerHTML = courseName;
        if(checked.checked)
            for(var i = 0; i < slotsPlus.length; i++)
                slotsPlus[i].innerHTML = courseName + "(+)";
        document.getElementById("course" + batch).value = "";
        document.getElementById("slot" + batch).value = "A" + batch;
        checked.checked = false;
    }
	
	//function for editing each cell induvidually
    function addText()
    {
        if(this.classList[0] == "lunch" || this.classList[0] == "top" || this.classList[0] == "side" || inEdit)
            return;
        inEdit = true;
        var input = document.createElement("input");
        input.value = this.innerHTML;
        input.size = 8;
        this.innerHTML = "";
        this.appendChild(input);
        input.focus();
        input.addEventListener("focusout", () => {
            input.parentElement.innerHTML = input.value;
            input.remove();
            inEdit = false;
        });
        input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                input.parentElement.innerHTML = input.value;
                input.remove();
                inEdit = false;
            }
        });
    }


    function exportpdf() {
   		var source = '#table1';
   		if (batch == 2) {
   			source = '#table2';
   		}
   		
   		var doc = new jsPDF('l', 'pt', 'a4');
    	var htmlstring = '';
    	var tempVarToCheckPageHeight = 0;
    	var pageHeight = 0;
    	pageHeight = doc.internal.pageSize.height;
    	specialElementHandlers = {
        	// element with id of "bypass" - jQuery style selector  
        	'#bypassme': function (element, renderer) {
            	// true = "handled elsewhere, bypass text extraction"  
            	return true
        	}
    	};
    	margins = {
        	top: 150,
        	bottom: 60,
        	left: 20,
        	right: 20,
        	width: 600
    	};
    	var y = 20;
    	doc.setLineWidth(2);
    	doc.autoTable({
        	html: source,  //sets the id of the table to be downloaded
        	startY: 70,
        	theme: 'grid',
        	columnStyles: {
        	    0: {
        	        cellWidth: 75,
        	    },
        	    1: {
        	        cellWidth: 70,
        	    },
        	    2: {
        	        cellWidth: 70,
        	    },
        	    3: {
        	        cellWidth: 70,
        	    },
        	    4: {
        	        cellWidth: 70,
        	    },
        	    5: {
        	        cellWidth: 70,
        	    },
        	    6: {
        	        cellWidth: 70,
                    halign:"center",
                    valign:'middle'
        	    },
        	    7: {
        	        cellWidth: 70,
        	    },
        	    8: {
        	        cellWidth: 70,
        	    },
        	    9: {
        	        cellWidth: 70,
        	    },
        	    10: {
        	        cellWidth: 70,
        	    },
        	    11: {
        	        cellWidth: 70,
        	    }
        	},
        	styles: {
        	    minCellHeight: 40
        	}
    	})
    	doc.save('output.pdf');
	}
	
    document.querySelectorAll("td").forEach(e => e.addEventListener("click", addText));
    
	
	//event handler for submit button
    var btn = document.getElementById("submitbtn1");
    btn.addEventListener("click", validateForm);
    document.getElementById("submitbtn2").addEventListener("click", validateForm);
    
    //event handler for pdf download button
    var pdfbtn = document.getElementById("pdfdownload");
    pdfbtn.addEventListener("click", exportpdf);
	
	//event handler for switching between batches
    document.getElementById("batchChange").addEventListener("click", () =>{
        document.getElementById("batch" + batch).style.display = "none";
        batch == 1 ? batch = 2 : batch = 1;
        document.getElementById("batch" + batch).style.display = "flex";
    });

    function generateUUID() { // Public Domain/MIT
    var d = new Date().getTime();//Timestamp
    var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16;//random number between 0 and 16
        if(d > 0){//Use timestamp until depleted
            r = (d + r)%16 | 0;
            d = Math.floor(d/16);
        } else {//Use microseconds since page-load if supported
            r = (d2 + r)%16 | 0;
            d2 = Math.floor(d2/16);
        }
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
}
    function getFormattedDate()
    {
        const date = new Date();
        var s = "";
        s += date.getFullYear();
        if(Math.floor((date.getMonth() + 1) / 10) == 0)
            s += "0";
        s += date.getMonth() + 1;
        if(Math.floor(date.getDate() / 10) == 0)
            s += "0";
        s += date.getDate();
        s += "T";
        if(Math.floor(date.getHours() / 10) == 0)
            s += "0";
        s += date.getHours();
        if(Math.floor(date.getMinutes() / 10) == 0)
            s += "0";
        s += date.getMinutes();
        if(Math.floor(date.getSeconds() / 10) == 0)
            s += "0";
        s += date.getSeconds();
        return s;
    }

    function getStart(t)
    {
        var s = "";
        s += "202301";
        switch(t[2])
        {
            case "SU":  s += "01";
                        break;
            case "MO":  s += "02";
                        break;
            case "TU":  s += "03";
                        break;
            case "WE":  s += "04";
                        break;
            case "TH":  s += "05";
                        break;
            case "FR":  s += "06";
                        break;
            case "SA":  s += "07";
                        break;
        }
        s += "T" + t[0] + "0000";
        return s;
    }

    function getEnd(t)
    {
        var s = "";
        s += "202301";
        switch(t[2])
        {
            case "SU":  s += "01";
                        break;
            case "MO":  s += "02";
                        break;
            case "TU":  s += "03";
                        break;
            case "WE":  s += "04";
                        break;
            case "TH":  s += "05";
                        break;
            case "FR":  s += "06";
                        break;
            case "SA":  s += "07";
                        break;
        }
        s += "T" + t[1].split(":")[0] + "5000";
        return s;
    }

    document.getElementById("iCal").addEventListener("click", () => {
        var calText="BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:TimeTableApp\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH";
        document.querySelectorAll("td").forEach(e => {
            console.log("HI");
            var text = e.innerHTML.trim();
            var s = getFormattedDate();
            if(e.classList[0] == "lunch" || e.classList[0] == "top" || e.classList[0] == "side" || text == "" || e.offsetParent == null)
                return;
            var t = e.classList[1].split("-");
            calText += "\nBEGIN:VEVENT\nSUMMARY:" + text + "\nUID:"+ generateUUID() +"\nDTSTART:" + getStart(t) + "\nDTEND:" + getEnd(t) + "\nDTSTAMP:"+ s +"\nRRULE:FREQ=WEEKLY;BYDAY="+ t[2] +";UNTIL=20230430;BYSETPOS=1;BYHOUR="+t[0]+";BYMINUTE=0\nEND:VEVENT";
        });
        calText += "\nEND:VCALENDAR";

        console.log(calText);

        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/calendar;charset=utf-8,' + encodeURIComponent(calText));
        element.setAttribute('download', 'calendar');
        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
    });
    
 </script>
</html>